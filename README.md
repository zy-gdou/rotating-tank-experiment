# 1.5-layer model for rotating-tank experiment
This is a finite-differencing model for the stream function-relative voticity equation 
$$\frac{\partial}{\partial t}(\nabla^2-k_d^2)\psi+J(\psi,\nabla^2\psi)+\beta\frac{\partial \psi}{\partial x}+\gamma\nabla^2\psi=Q$$

1. $\psi$ is the stream function;
2. $\zeta=\nabla^2\psi$ is the relative voriticyt;
3. $k_d=1/R_d$ with the deformation radius $R_d$;
4. $J(\psi,\zeta)=\psi_x\zeta_y-\zeta_x\psi_y$ is the nonlinear advection written in a Jacobian form;
5. $\beta$ is the topographic beta effect;
6. $\gamma$ is the Ekman friction;
7. $Q$ is the exeternal forcing. 

The $\psi-zeta$ equation has been historically employed to simplify the [Shallow Water Equations](https://en.wikipedia.org/wiki/Shallow_water_equations).  In practice, an additional visocisity term $A_h \nabla^2\zeta$ should be added in the RHS in order too damp the shor waves and maitain numerical stability. 


Here, we use $\psi-\zeta$ equation to model the barotropic flow in the rotating tank experiments. The tank has a diameter of 110cm and a depth of 40cm and is installed in a turnable table. Before the experiment, a solid barrier was placed inside the tank and was aligned in the raidal direction. This barrier acts as the west wall to the flows generated by a localized source located to the east. 

The geometry configuration was recorded by a camera as full-color pictures saved in './for_grid_gen/'. Since the location/orientation of the wall was varied in some experiments, you may find multiple images there. The following is an example showing one configuration used in the experiment:

<img src="https://github.com/zy-gdou/rotating-tank-experiment/blob/385a69e7659770761996ae03dda59c8295bc769b/for_grid_gen/4oclock.png" width=50% height=50%>

This image can be used by "genXYgrid_vect.m" to create a gird file for a specific geometry configuration. The grid file is named as "N?.mat" with "?" standing for the horizontal grid resolution(default value 500). It must be generated before runing the code and is saved in the same directory as "genXYgrid_vect.m". 

A square domain occupied by the tank is discretized as horizontal Cartesian grid. Only the region inside the tank is modeled.
"genXYgrid_vect.m" defines the boundary points(the points located at the side wall of the tank), ghost points(points dropping outside of the tank with  a distance of 1 dx to the neighouring boundary points, where dx is the grid size), and inside points(points dropping inside the tank which are the major part of the total node population). This classification is useful to implement the boundary conditions. Two boundary conditions (no-slip and free-slip) can be applied the lateral boundaries(side wall of the cylindrical tank and 3 sides of the barrier) using one of the schemes in the review paper by E, Weinan & Liu, Guoqiang 1996(Journal of Computational Physics).

'sweep_run.m' defines the parameter space we are going to survey. The key parameters are:
1. amplitude of the forcign vortex: Amp, $s^-2$ ;
2. radius of the forcing vortex: foring_R , cm; 
3. barotropic deformation radius: Rd,cm; 
3. Ekman friction: gamma, $s^{-1}$; 
4. bulck viscosity: Ah, $cm^2/s$ 

Given the simplicity of the stream function-relative vorticity equation, its dimensional form is discretized; this makes the code more readable and results easier to interpret. In "sweep_run.m", user can also specify
1. the total time of integration:T_tot,s;
2. output frequency:dt,s; 
3. logical switch for the types of the boundary condition: noslip=true by default;
4. logical switch for nonlinear advection: nonlinear=true by default; otherwise the nonlinear advection term won't be included.

'pars.m' checks if this is a new run or a restart from any previous run. If there is no folder with the name specified as the parameter combination given in sweep_run.m, then a new folder will be created, a new run starts, and the output files will be saved in that new folder. If there is an exist folder with the same name as specified in the "sweep_run.m" and that folder contains multiple output files (.mat), then this is a restart run. The initial condition is given by the last output file from the previous run. The restart run then adds output files to the old folder. 'pars.m' also contains other experimental parameters needed for the simulation and useful coefficients for the Possion equation solver and the time marching schemes. 

'main_iter_4step_RungeKutta.m' is the main iteration part. It marches the governning eq. in time using 4th-order explicit Runge-Kutta scheme for the nonlinear term(with Arakawa 1966's conserving scheme for the spatial discretization) if nonlinear=true, and explicit (2nd-order central differencing) for the other terms(beta term, Ekman term, diffusion term). 

'allocate_matrices.m' initialize the matrices for the variables used by the simulation by allocating 1D vectors for them. This allocation is called everytime when the model starts (no matter if it is a new run or a restart run) .


One example of the simulation results (relative vorticity normalized by the Coriolis parameter) is shown in the [![video]()](https://youtu.be/C0-KzsiVW-g)

# Double-Fourier theory 
'bplume_slantwall_unrotate_lab.m' formulated the Double-Fourier(linear) theory. This theory is used to decompose the total wave field into the incidental and the reflected ones in a rectangular domain (a Cartesian coordinate system). It shows that the formation of the meanders at the flanks of the beta-plume caused by the reflected Rossby waves.

